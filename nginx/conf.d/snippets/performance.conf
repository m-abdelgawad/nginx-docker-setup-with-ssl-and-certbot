# --- Gzip + proxy buffer tweaks ----------------------------------------
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml \
          application/xml application/xml+rss text/javascript image/svg+xml \
          application/x-font-ttf font/opentype font/woff font/woff2;
gzip_proxied any;
gzip_min_length 256;
gzip_comp_level 5;
gzip_vary on;

# Brotli compression (if available)
brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/javascript text/xml \
            application/xml application/xml+rss text/javascript image/svg+xml \
            application/x-font-ttf font/opentype font/woff font/woff2;

proxy_buffer_size          128k;
proxy_buffers              4 256k;
proxy_busy_buffers_size    256k;
proxy_temp_file_write_size 256k;

# Enable open file cache
open_file_cache max=1000 inactive=20s;
open_file_cache_valid 30s;
open_file_cache_min_uses 2;
open_file_cache_errors on;

# TCP optimizations
tcp_nopush on;
tcp_nodelay on;

# Keepalive
keepalive_timeout 65;
keepalive_requests 100;

# Client body buffer
client_body_buffer_size 128k;
client_max_body_size 10m;
client_body_timeout 12;
client_header_timeout 12;

# Send timeout
send_timeout 10;

# Hide nginx version
server_tokens off;
